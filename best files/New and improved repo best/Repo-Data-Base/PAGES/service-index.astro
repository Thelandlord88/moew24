---
/**
 * Dynamic Service Pages
 * Generates pages for each service (bond-cleaning, carpet-cleaning, etc.)
 */
import { geoConfig, enrichedClusters } from '../../../lib/geoCompat.ts';
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import SEOHead from '../../../components/seo/SEOHead.astro';
import StructuredData from '../../../components/seo/StructuredData.astro';
import QuoteForm from '../../../components/QuoteForm.astro';

export async function getStaticPaths() {
  const config = geoConfig();
  
  return config.services.map(service => ({
    params: { service },
    props: { service }
  }));
}

const { service } = Astro.params;
const config = geoConfig();
const clusters = enrichedClusters();

// Get service-related blog posts
const allPosts = await getCollection('posts');
const servicePosts = allPosts.filter(post => 
  post.data.service === service || 
  post.data.tags.includes(service) ||
  post.data.title.toLowerCase().includes(service.replace('-', ' '))
).slice(0, 6);

// Format service name for display
const serviceName = service.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());

const title = `Professional ${serviceName} Services`;
const description = `Expert ${serviceName.toLowerCase()} services across Brisbane, Logan, and Ipswich. ${config.brand} provides reliable, professional cleaning with a 100% satisfaction guarantee.`;
---

<BaseLayout 
  title={title}
  description={description}
  canonicalURL={new URL(`/services/${service}`, Astro.site)}
>
  <SEOHead 
    slot="head"
    title={title}
    description={description}
    ogType="website"
    service={service}
  />
  <StructuredData 
    slot="head"
    type="service"
    title={title}
    description={description}
    service={service}
  />

  <main class="container mx-auto px-4 py-8">

    <!-- Hero Section -->
    <div class="text-center">
      <h1 class="text-4xl font-bold text-brand">
        {serviceName} Services
      </h1>
      <p class="text-xl text-slate-600 max-w-3xl mx-auto">
        {description}
      </p>
    </div>

    <!-- Service Details -->
    <div class="grid md:grid-cols-2 gap-8 mt-12">
      <div>
        <h2 class="text-2xl font-semibold text-brand">
          Why Choose Our {serviceName} Service?
        </h2>
        <ul class="mt-4 space-y-2 text-slate-600">
          <li>✓ Professional Equipment: Commercial-grade cleaning equipment and eco-friendly products</li>
          <li>✓ Experienced Team: Trained professionals with years of experience</li>
          <li>✓ Satisfaction Guarantee: 100% satisfaction guaranteed</li>
        </ul>
      </div>

      <!-- Quote Form -->
      <div class="border rounded-xl p-6">
        <h3 class="text-xl font-semibold text-brand">
          Get Your Free Quote
        </h3>
        <QuoteForm />
      </div>
    </div>

    <!-- Service Areas -->
    <div class="mt-12">
      <h2 class="text-2xl font-semibold text-center text-brand">
        {serviceName} Service Areas
      </h2>
      <div class="grid md:grid-cols-3 gap-6 mt-6">
        {clusters.map(cluster => (
          <div class="border rounded-xl p-6">
            <h3 class="text-xl font-semibold text-brand">{cluster.name}</h3>
            <div class="mt-4 space-y-1">
              {cluster.suburbs.slice(0, 5).map(suburb => (
                <a 
                  href={`/services/${service}/${suburb.slug}`}
                  class="block text-blue-600 hover:underline"
                >
                  {suburb.name}
                </a>
              ))}
              {cluster.suburbs.length > 5 && (
                <p class="text-slate-500 text-sm">
                  +{cluster.suburbs.length - 5} more suburbs
                </p>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Internal Links -->
    <!-- <InternalLinks 
      contentType="service"
      service={service}
      title="Related Services & Areas"
    /> -->
  </main>
</BaseLayout>