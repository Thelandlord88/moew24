---
interface Props {
  variant?: 'inline' | 'sticky' | 'page';
  source?: string; // Track where quote came from
}

const { variant = 'inline', source = 'unknown' } = Astro.props;

const formId = 'quote-form';
const isSticky = variant === 'sticky';
const isPage = variant === 'page';
---

<div class={`quote-form-container ${isSticky ? 'sticky-quote' : ''} ${isPage ? 'page-quote' : ''}`}>
  <form 
    id={formId}
    class="quote-form bg-white rounded-lg border-2 border-brand p-6 shadow-lg"
    data-source={source}
  >
    <h3 class="text-xl font-bold mb-4 text-brand">
      {isPage ? 'Request Your Free Quote' : 'Get Free Quote'}
    </h3>
    
    <div class="grid gap-4 md:grid-cols-2">
      <div>
        <label for="name" class="block text-sm font-medium mb-1">Full Name *</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          required
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
          placeholder="Your name"
        />
      </div>
      
      <div>
        <label for="phone" class="block text-sm font-medium mb-1">Phone *</label>
        <input 
          type="tel" 
          id="phone" 
          name="phone" 
          required
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
          placeholder="0400 000 000"
        />
      </div>
    </div>
    
    <div>
      <label for="email" class="block text-sm font-medium mb-1 mt-4">Email</label>
      <input 
        type="email" 
        id="email" 
        name="email"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
        placeholder="your@email.com"
      />
    </div>
    
    <div>
      <label for="property-type" class="block text-sm font-medium mb-1 mt-4">Property Type *</label>
      <select 
        id="property-type" 
        name="property-type" 
        required
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
      >
        <option value="">Select property type</option>
        <option value="1-bed-apartment">1-Bedroom Apartment</option>
        <option value="2-bed-unit">2-Bedroom Unit</option>
        <option value="3-bed-house">3-Bedroom House</option>
        <option value="4-bed-house">4+ Bedroom House</option>
        <option value="townhouse">Townhouse</option>
        <option value="other">Other</option>
      </select>
    </div>
    
    <div>
      <label for="suburb" class="block text-sm font-medium mb-1 mt-4">Suburb *</label>
      <input 
        type="text" 
        id="suburb" 
        name="suburb" 
        required
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
        placeholder="Brisbane, Logan, Ipswich..."
      />
    </div>
    
    <div>
      <label for="inspection-date" class="block text-sm font-medium mb-1 mt-4">Inspection Date</label>
      <input 
        type="date" 
        id="inspection-date" 
        name="inspection-date"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
        min={(() => {
          const d = new Date();
          const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), day = String(d.getDate()).padStart(2,'0');
          return `${y}-${m}-${day}`; // local YYYY-MM-DD
        })()}
      />
    </div>
    
    <div>
      <label for="message" class="block text-sm font-medium mb-1 mt-4">Additional Details</label>
      <textarea 
        id="message" 
        name="message" 
        rows="3"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-brand"
        placeholder="Any special requirements, urgency, or questions..."
      ></textarea>
    </div>
    
    <button 
      type="submit" 
      class="w-full mt-6 bg-brand text-white py-3 px-6 rounded-md font-semibold hover:bg-brand/90 transition-colors"
    >
      Get My Free Quote
    </button>
    
    <p class="text-xs text-slate-500 mt-3 text-center">
      Free quotes • No obligation • Response within 2 hours
    </p>
  </form>
</div>

<style>
  .sticky-quote {
    position: sticky;
    top: 20px;
    z-index: 10;
  }
  
  .page-quote {
    max-width: 600px;
    margin: 0 auto;
  }
  
  @media (max-width: 768px) {
    .sticky-quote {
      position: relative;
      top: auto;
      margin: 20px 0;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = /** @type {HTMLFormElement|null} */ (document.getElementById('quote-form'));
    if (!form) return;
    
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const source = form.dataset.source || 'unknown';
      
      // Track quote submission via analytics shim
      window.analytics?.('lead_submit', { source });
      
      // Log for debugging (remove in production)
      console.log('Quote submitted from:', source);
      console.log('Form data:', Object.fromEntries(formData));
      
      // Simulate form submission
      form.innerHTML = `
        <div class="text-center py-8">
          <div class="text-green-600 text-4xl mb-4">✓</div>
          <h3 class="text-xl font-bold mb-2">Quote Request Sent!</h3>
          <p class="text-slate-600 mb-4">We'll call you within 2 hours with your free quote.</p>
          <p class="text-sm text-slate-500">Reference: QR-${Date.now().toString().slice(-6)}</p>
        </div>
      `;
      
      // Redirect to thank you page after short delay
      setTimeout(() => {
        window.location.href = '/quote/thank-you/';
      }, 3000);
    });
  });
</script>
